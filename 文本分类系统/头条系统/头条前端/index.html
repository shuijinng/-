<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¤´æ¡çƒ­ç‚¹åˆ†ç±»ç³»ç»Ÿ</title>

  <!-- å¼•å…¥ React å’Œ ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- å¼•å…¥ Babel ä»¥æ”¯æŒ JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- å¼•å…¥ GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
      --primary: #3b82f6;
      --primary-light: #60a5fa;
      --primary-dark: #2563eb;
      --secondary: #8b5cf6;
      --secondary-light: #a78bfa;
      --secondary-dark: #7c3aed;
      --background: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --border: #e2e8f0;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--background);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      overflow: hidden;
    }

    /* èƒŒæ™¯åŠ¨ç”»æ•ˆæœ */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 35%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 75%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
      animation: float 20s infinite linear;
    }

    @keyframes float {
      0% { transform: translate(0, 0); }
      50% { transform: translate(20px, 20px); }
      100% { transform: translate(0, 0); }
    }

    .container {
      width: 800px;
      max-width: 90vw;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      position: relative;
      z-index: 1;
    }

    .header {
      text-align: center;
      margin-bottom: 1rem;
    }

    /* æ ‡é¢˜å®¹å™¨ */
    .title-wrapper {
      display: flex;
      justify-content: center;
      position: relative;
      margin-bottom: 0.5rem;
    }

    /* ä¸»æ ‡é¢˜ */
    .title {
      font-size: 2.6rem;
      font-weight: 700;
      color: var(--text);
      display: flex;
      gap: 0.05em;
      font-family: 'Microsoft YaHei', sans-serif;
      position: relative;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .title-char {
      opacity: 0;
      display: inline-block;
      transform-origin: bottom center;
    }

    /* å…‰æ‰«æ•ˆæœ */
    .title::after {
      content: "";
      position: absolute;
      top: 0;
      left: -60%;
      width: 60%;
      height: 100%;
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.5) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      transform: skewX(-20deg);
      animation: glowSwipe 3.5s ease-in-out infinite;
      pointer-events: none;
      opacity: 0.8;
    }

    @keyframes glowSwipe {
      0% { left: -60%; }
      50% { left: 100%; }
      100% { left: -60%; }
    }

    .subtitle {
      font-size: 1rem;
      color: #64748b;
      opacity: 0;
      font-weight: 400;
    }

    .main-content {
      display: flex;
      gap: 2rem;
      width: 100%;
    }

    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
    }

    .card {
      flex: 1;
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 1.5rem;
      box-shadow: var(--shadow);
      backdrop-filter: blur(4px);
      border: 1px solid var(--border);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      border-color: var(--primary-light);
    }

    .card-header {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-header::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--primary);
      transition: background 0.3s ease;
    }

    .card-input:hover .card-header::before,
    .card-output:hover .card-header::before {
      background: var(--secondary);
    }

    .textarea {
      flex: 1;
      width: 100%;
      min-height: 200px;
      padding: 1rem;
      border: 2px solid var(--border);
      border-radius: 1rem;
      outline: none;
      resize: vertical;
      font-size: 1rem;
      color: var(--text);
      background: white;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: inherit;
    }

    .textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .textarea::placeholder {
      color: #94a3b8;
      opacity: 0.8;
    }

    /* ========== æŒ‰é’®åŸºç¡€æ ·å¼ ========== */
    /* å‡è®¾ä½ å·²æœ‰ç±»ä¼¼ .button çš„åŸºç¡€æ ·å¼ï¼Œè¿™é‡Œè¡¥å……å¢å¼º */
    .button {
      /* ä¿æŒä½ åŸæœ‰çš„æ ·å¼ (padding, font, border-radius ç­‰) */
      position: relative;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      color: #ffffff;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      outline: none;
      box-shadow: 0 4px 14px rgba(102, 126, 234, 0.3);
      overflow: hidden; /* âœ… å…³é”®ï¼šè£å‰ªåŠ¨ç”»æ¡ */
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      transform: none;
    }
    
    /* ========== åŠ¨ç”»æ¡æ ·å¼ ========== */
    /* è¿™æ˜¯å®ç°â€œä»å·¦å¾€å³å¡«å……â€çš„æ ¸å¿ƒ */
    .feedback-bar {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%; /* å›ºå®šå®½åº¦ */
      height: 100%;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.1));
      transform: scaleX(0); /* åˆå§‹ï¼šå®½åº¦ç¼©ä¸º 0 */
      transform-origin: left center; /* ä»å·¦è¾¹å¼€å§‹ç¼©æ”¾ */
      transition: transform 0.5s ease;
    }
    
    .button:hover .feedback-bar {
      transform: scaleX(1); /* æ°´å¹³æ‹‰ä¼¸åˆ° 100% */
    }
    
    /* ========== å¯é€‰ï¼šæ¶Ÿæ¼ªæ•ˆæœ (å¢å¼ºåé¦ˆ) ========== */
    .button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: all 0.3s ease;
      pointer-events: none;
      z-index: 0;
    }
    
    .button:active:not(:disabled)::after {
      width: 300px;
      height: 300px;
      opacity: 0;
    }
    
    /* ========== æŒ‰é’®æ–‡æœ¬æ ·å¼ ========== */
    /* ç¡®ä¿æ–‡æœ¬åœ¨åŠ¨ç”»å±‚ä¹‹ä¸Š */
    .btn-text {
      position: relative;
      z-index: 2;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
	/* ===== ç»Ÿä¸€çš„åŠ è½½åŠ¨ç”»ç±» ===== */
	/* ç”¨äºæŒ‰é’®å’Œä»»ä½•éœ€è¦åŠ è½½æŒ‡ç¤ºçš„åœ°æ–¹ */
	.loading {
	  display: inline-block;
	  width: 16px;
	  height: 16px;
	  border: 2px solid #ffffff;
	  /* æ¨èä½¿ç”¨ border-top-color: transparent æ–¹å¼ï¼Œæ›´å¸¸è§ */
	  border-color: #ffffff #ffffff #ffffff transparent; /* æˆ–è€… border-top-color: transparent */
	  border-radius: 50%;
	  /* ä½¿ç”¨æ›´æµç•…çš„åŠ¨ç”»æ—¶é•¿ */
	  animation: spin 1s linear infinite;
	}
	
	/* å¦‚æœä½ æƒ³ä¿ç•™ä¸åŒçš„åŠ¨ç”»åç§°ï¼Œä¹Ÿå¯ä»¥ï¼Œä½†å»ºè®®ç»Ÿä¸€ */
	@keyframes spin {
	  0% { transform: rotate(0deg); }
	  100% { transform: rotate(360deg); }
	}
	

    .output {
      flex: 1;
      width: 100%;
      min-height: 200px;
      padding: 1rem;
      border: 2px solid var(--border);
      border-radius: 1rem;
      overflow-y: auto;
      font-size: 1rem;
      color: var(--text);
      background: white;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: pre-line;
      line-height: 1.8;
    }

    .output.empty {
      color: #94a3b8;
      font-style: italic;
    }

    /* æ»šåŠ¨æ¡æ ·å¼ */
    .output::-webkit-scrollbar {
      width: 8px;
    }

    .output::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }

    .output::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    .output::-webkit-scrollbar-thumb:hover {
      background: #cbd5e1;
    }


    /* è¾“å…¥å¡ç‰‡ç±» */
    .card-input {
      position: relative;
    }

    /* è¾“å‡ºå¡ç‰‡ç±» */
    .card-output {
      position: relative;
    }

    /* === ä¼˜åŒ–åçš„ç®€æ´ç»“æœæ ·å¼ (æ›¿ä»£äº†å¤æ‚çš„è¿›åº¦æ¡CSS) === */
    .result-text {
      font-family: 'SF Pro Text', 'Segoe UI', sans-serif;
      line-height: 1.8;
      color: #1f2937;
      white-space: pre-wrap;
    }

    .result-text strong {
      color: #059669;
      font-weight: 600;
    }

    .result-text .model-name {
      font-weight: 500;
      color: #374151;
    }

    .result-text .confidence {
      color: #6b7280;
      font-size: 0.95em;
    }

    .result-text .final-result {
      margin-top: 1rem;
      font-size: 1.1em;
      color: #059669;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- React æ¸²æŸ“å…¥å£ -->
  <div id="root"></div>

  <!-- ä½¿ç”¨ Babel ç¼–è¯‘çš„ React è„šæœ¬ -->
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const Home = () => {
      const [input, setInput] = useState('');
      const [output, setOutput] = useState('');
      const [loading, setLoading] = useState(false);
      const textareaRef = useRef(null);
      const outputRef = useRef(null);

      // ä¸ºæ ‡é¢˜å­—ç¬¦åˆ›å»º ref æ•°ç»„
      const titleRefs = Array.from("å¤´æ¡çƒ­ç‚¹åˆ†ç±»ç³»ç»Ÿ").map(() => useRef(null));
      const subtitleRef = useRef(null);

      // æ ‡é¢˜åŠ¨ç”»
      useEffect(() => {
        if (typeof gsap === 'undefined') return;

        const timer = setTimeout(() => {
          // æ ‡é¢˜é€å­—åŠ¨ç”»
          gsap.fromTo(
            titleRefs.map(r => r.current),
            { opacity: 0, y: 40, skewY: 10 },
            {
              opacity: 1,
              y: 0,
              skewY: 0,
              duration: 0.8,
              stagger: 0.12,
              ease: "back.out(1.3)",
              overwrite: "auto"
            }
          );

          // å‰¯æ ‡é¢˜æ·¡å…¥
          gsap.fromTo(
            subtitleRef.current,
            { opacity: 0, y: 15 },
            { 
              opacity: 1, 
              y: 0, 
              duration: 1, 
              delay: 0.8,
              ease: "power2.out" 
            }
          );
        }, 300);

        return () => clearTimeout(timer);
      }, []); // ä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„ï¼Œåªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ

      // æ–‡æœ¬åŒºåŸŸèšç„¦åŠ¨ç”»
      useEffect(() => {
        if (typeof gsap === 'undefined' || !textareaRef.current) return;

        const el = textareaRef.current;
        const onFocus = () => {
          gsap.to(el, { 
            duration: 0.3, 
            scale: 1.02, 
            borderColor: 'var(--primary)',
            boxShadow: '0 0 0 3px rgba(59, 130, 246, 0.2)'
          });
        };
        const onBlur = () => {
          gsap.to(el, { 
            duration: 0.3, 
            scale: 1, 
            borderColor: 'var(--border)', 
            boxShadow: 'none' 
          });
        };

        el.addEventListener('focus', onFocus);
        el.addEventListener('blur', onBlur);

        // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
        return () => {
          el.removeEventListener('focus', onFocus);
          el.removeEventListener('blur', onBlur);
        };
      }, []); // ä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„ï¼Œåªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ

      // è¾“å‡ºæ‰“å­—æœºæ•ˆæœï¼ˆæ”¯æŒæ¢è¡Œï¼‰
      useEffect(() => {
        if (!output || !outputRef.current) return;
      
        gsap.killTweensOf(outputRef.current);
      
        const target = { progress: 0 };
        const duration = Math.max(1, Math.min(3, output.length / 20));
        const totalChars = output.length;
      
        gsap.to(target, {
          progress: totalChars,
          duration: duration,
          ease: "power1.out",
          onUpdate: () => {
            const current = Math.floor(target.progress);
            outputRef.current.textContent = output.slice(0, current);
          },
          onComplete: () => {
            outputRef.current.textContent = output;
          }
        });
      }, [output]); // ä¿®å¤ï¼šæ·»åŠ  output ä½œä¸ºä¾èµ–é¡¹

      // æäº¤å¤„ç† - ä¿®æ”¹ç‰ˆ (æ‰“å­—æœºæ‰“å®Œå³ç»ˆæ€)
      const handleSubmit = async () => {
        if (!input.trim()) {
          setOutput('è¯·è¾“å…¥ä¸€äº›æ–‡æœ¬ã€‚');
          return;
        }
      
        // å¡ç‰‡ç‚¹å‡»åé¦ˆ
        if (typeof gsap !== 'undefined') {
          gsap.to(".card-input", { duration: 0.2, scale: 0.98, ease: "power1.in" });
          gsap.to(".card-output", { duration: 0.2, scale: 0.98, ease: "power1.in" });
        }
      
        setLoading(true);
        setOutput(''); // æ¸…ç©ºä¹‹å‰çš„è¾“å‡º
      
        try {
          const response = await fetch('http://localhost:8000/predict', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ text: input }),
          });
      
          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}\n${errorText}`);
          }
      
          const data = await response.json();
      
          // âœ… å¤šæ¨¡å‹ç»“æœå¤„ç†
          const models = [
            { name: "éšæœºæ£®æ—", result: data.random_forest },
            { name: "fastText", result: data.fasttext },
            { name: "BERT", result: data.bert }
          ];
      
          // âœ… ç”Ÿæˆæœ€ç»ˆçš„ã€æ ¼å¼è‰¯å¥½çš„çº¯æ–‡æœ¬ï¼ˆè¿™ä¸ªå°±æ˜¯æ‰“å­—æœºæ‰“å‡ºçš„å†…å®¹ï¼Œä¹Ÿæ˜¯æœ€ç»ˆæ˜¾ç¤ºçš„å†…å®¹ï¼‰
          const modelLines = models.map(m => {
            const category = m.result?.category || "æœªçŸ¥";
            const confidence = m.result?.confidence != null ? m.result.confidence : 0;
            const confClipped = Math.max(0, Math.min(1, confidence));
            const confPercent = (confClipped * 100).toFixed(0); // ç½®ä¿¡åº¦å–æ•´æ•°ï¼Œæ›´ç®€æ´
            return `  â€¢ ${m.name}: ${category} (${confPercent}%)`; // ä½¿ç”¨ â€¢ ç¬¦å·ï¼Œæ›´ç¾è§‚
          }).join('\n');
      
          // âœ… æŠ•ç¥¨å…±è¯†
          const votes = models
            .map(m => m.result?.category)
            .filter(cat => cat && cat !== "unknown" && cat !== "æœªçŸ¥");
      
          let finalCategory = "æ— æ³•åˆ¤æ–­";
          if (votes.length > 0) {
            const voteCount = {};
            votes.forEach(v => voteCount[v] = (voteCount[v] || 0) + 1);
            finalCategory = Object.keys(voteCount).reduce((a, b) => 
              voteCount[a] > voteCount[b] ? a : b
            );
          }
      
          // âœ… æ ¸å¿ƒï¼šè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯æœ€ç»ˆè¦æ˜¾ç¤ºçš„å†…å®¹ï¼Œæ‰“å­—æœºä¼šé€å­—æ‰“å‡ºå®ƒ
          const finalOutputText = `ğŸ“Š å¤šæ¨¡å‹åˆ†ç±»ç»“æœï¼š
      ${modelLines}
      
      ğŸ æœ€ç»ˆå…±è¯†: ${finalCategory}`;
      
          // âœ… è®¾ç½®çŠ¶æ€ï¼Œè§¦å‘æ‰“å­—æœºæ•ˆæœ
          setOutput(finalOutputText);
      
          // âœ… ç§»é™¤ï¼šä¸å†éœ€è¦ setTimeout æ¥æ›¿æ¢å†…å®¹
      
          // å¡ç‰‡å¼¹èµ·åŠ¨ç”»
          if (typeof gsap !== 'undefined') {
            gsap.to(".card-input, .card-output", {
              scale: 1,
              duration: 0.4,
              ease: "back.out(1.2)",
              delay: 0.1
            });
          }
      
        } catch (error) {
          console.error("åˆ†ç±»è¯·æ±‚å¤±è´¥:", error);
          const errorMsg = error.message.includes("fetch")
            ? "æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·ç¡®ä¿ FastAPI å·²å¯åŠ¨ï¼ˆhttp://localhost:8000ï¼‰"
            : `å¤„ç†å¤±è´¥ï¼š${error.message}`;
          setOutput(errorMsg); // é”™è¯¯ä¿¡æ¯ä¹Ÿé€šè¿‡æ‰“å­—æœºæ‰“å‡º
      
          // é”™è¯¯æŠ–åŠ¨åŠ¨ç”»
          if (typeof gsap !== 'undefined') {
            gsap.to(".card-output", {
              x: -5,
              duration: 0.1,
              repeat: 3,
              yoyo: true,
              onComplete: () => gsap.set(".card-output", { clearProps: "x" })
            });
          }
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="container">
          <div className="header">
            <div className="title-wrapper">
              <h1 className="title">
                {Array.from("å¤´æ¡çƒ­ç‚¹åˆ†ç±»ç³»ç»Ÿ").map((char, index) => (
                  <span
                    key={index}
                    ref={titleRefs[index]}
                    className="title-char"
                  >
                    {char}
                  </span>
                ))}
              </h1>
            </div>
            <p ref={subtitleRef} className="subtitle">
              åŸºäºæœºå™¨å­¦ä¹ çš„æ–‡æœ¬åˆ†ç±»ç³»ç»Ÿ
            </p>
          </div>

          <div className="main-content">
            <div className="card card-input">
              <h2 className="card-header">è¾“å…¥æ–‡æœ¬</h2>
              <textarea
                ref={textareaRef}
                value={input}
                onChange={(e) => setInput(e.target.value)}
                placeholder="è¯·è¾“å…¥è¦åˆ†ç±»çš„æ–°é—»æ ‡é¢˜æˆ–çŸ­æ–‡æœ¬..."
                className="textarea"
                disabled={loading}
              />
              <button
                className="button"
                onClick={handleSubmit}
                disabled={loading}
                // ğŸ‘‡ æ·»åŠ  aria-label æå‡å¯è®¿é—®æ€§
                aria-label={loading ? "å¤„ç†ä¸­" : "å¼€å§‹åˆ†ç±»"}
              >
                {/* ğŸ‘‡ æŒ‰é’®æ–‡æœ¬ */}
                <span className="btn-text">
                  {loading ? (
                    <>
                      <span className="loading"></span>
                      å¤„ç†ä¸­...
                    </>
                  ) : (
                    "å¼€å§‹åˆ†ç±»"
                  )}
                </span>
          
                {/* ğŸ‘‡ åŠ¨ç”»æ¡ï¼šä»å·¦å‘å³å¡«å……çš„åé¦ˆå±‚ */}
                <span className="feedback-bar"></span>
              </button>
            </div>
          </div>

            <div className="card card-output">
              <h2 className="card-header">è¾“å‡ºç»“æœ</h2>
              <div
                ref={outputRef}
                className={`output ${!output ? 'empty' : ''}`}
                style={{ whiteSpace: 'pre-line' }}
              >
                {output || 'å¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...'}
              </div>
            </div>
          </div>
      );
    }

    // æ¸²æŸ“ç»„ä»¶
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Home />);
  </script>
</body>
</html>