import random
from neo4j import GraphDatabase

# ========== é…ç½® ==========
URI = "bolt://localhost:7687"
USERNAME = "neo4j"
PASSWORD = "12345678"  # â—è¯·æ›¿æ¢ä¸ºä½ çš„å®é™…å¯†ç 

# ========== ä½ çš„æ•°æ® ==========
data = {
  "count": 175,
  "detail": {
    "companies": [
      "ä¸‡è¾¾å½±è§†",
      "ä¸Šå½±é›†å›¢",
      "ä¸Šæµ·ä¸œæ–¹å½±è§†å‘è¡Œæœ‰é™è´£ä»»å…¬å¸",
      "ä¸Šæµ·ç¹èŠ±é‡Œä¼ä¸šå‘å±•æœ‰é™å…¬å¸",
      "ä¸­å›½ç”µå½±è‚¡ä»½æœ‰é™å…¬å¸",
      "ä¸­å½±é›†å›¢",
      "å…‰çº¿ä¼ åª’",
      "åŒ—äº¬ç”µå½±åˆ¶ç‰‡å‚",
      "åŒ—äº¬ç”µå½±å­¦é™¢é’å¹´ç”µå½±åˆ¶ç‰‡å‚",
      "åŒ—äº¬ç”µè§†è‰ºæœ¯ä¸­å¿ƒ",
      "åçº³å…„å¼Ÿ",
      "åè°Š",
      "åè°Šå…„å¼Ÿ",
      "åè°Šå…„å¼Ÿä¼ åª’æœ‰é™å…¬å¸",
      "åè°Šå…„å¼Ÿä¼ åª’é›†å›¢",
      "åšçº³å½±ä¸š",
      "å¤©å¹•åˆ¶ä½œæœ‰é™å…¬å¸",
      "å¹¿è¥¿ç”µå½±åˆ¶ç‰‡å‚",
      "å½±ä¹‹æ°åˆ¶ä½œæœ‰é™å…¬å¸",
      "æ–°ä¸½ä¼ åª’è‚¡ä»½æœ‰é™å…¬å¸",
      "æ–°è‰ºåŸå½±ä¸šå…¬å¸",
      "æ°¸ä½³å½±ä¸šæœ‰é™å…¬å¸",
      "æ±¤è‡£ç”µå½±æœ‰é™å…¬å¸",
      "æ³½ä¸œç”µå½±å…¬å¸",
      "æ´¾æ‹‰è’™ä¸­å›½",
      "æµ™æ±Ÿä¸œé˜³ç¾æ‹‰ä¼ åª’æœ‰é™",
      "æµ™æ±Ÿä¸œé˜³ç¾æ‹‰ä¼ åª’æœ‰é™å…¬å¸",
      "ç¯çƒå½±ä¸š",
      "ç´¢å°¼ç”µå½±å¨±ä¹å…¬å¸",
      "ç¾å›½ç¦æ–¯æ¢ç…§ç¯å…¬å¸",
      "è…¾è®¯å½±ä¸š",
      "è¥¿å®‰ç”µå½±åˆ¶ç‰‡å‚",
      "è¿ªå£«å°¼ä¸­å›½",
      "é˜¿é‡Œå½±ä¸š"
    ],
    "movies": [
      "ä¸€ç§’é’Ÿ",
      "å“ªå’ä¹‹é­”ç«¥é™ä¸–",
      "åœ°ä¹…å¤©é•¿",
      "æ‚¬å´–ä¹‹ä¸Š",
      "æˆ‘ä¸æ˜¯è¯ç¥",
      "æˆ‘ä¸æ˜¯è¯ç¥_222",
      "æˆ˜ç‹¼",
      "æ— é—´é“",
      "æµæµªåœ°çƒ",
      "çº¢æµ·è¡ŒåŠ¨",
      "è®©å­å¼¹é£",
      "è®©å­å¼¹é£_423",
      "è¿½é£ç­çš„äºº",
      "è¿½é£ç­çš„äºº_741",
      "è¿½é£ç­çš„äºº_781"
    ],
    "persons": [
      "davidyates",
      "guynormanbee",
      "ä¸‡ç›æ‰æ—¦",
      "ä¸¥æ­Œè‹“",
      "ä¸¹å°¼æ–¯Â·éœç€",
      "ä¹”æ²»Â·å·´å¸ƒé²é˜¿å°¼",
      "äºšå½“Â·é›·çº³",
      "ä»»è¾¾å",
      "å€ªæ·‘å›",
      "å‚…å½ª",
      "å…ƒå½ª",
      "å…³ä¹‹ç³",
      "å†¯å°åˆš",
      "å†¯æ·¬å¸†",
      "åˆ˜å¾·å",
      "åˆ˜æ’",
      "åˆ˜æ˜Šç„¶",
      "åˆ˜è‹¥è‹±",
      "åˆ˜é•‡ä¼Ÿ",
      "å¢å† å»·",
      "å¶å€©æ–‡",
      "å•ä¸½è",
      "å•è‰¯ä¼Ÿ",
      "å´äº¬",
      "å´å€©è²",
      "å´å°äº‘",
      "å‘¨æ¶¦å‘",
      "å¤é’¢",
      "å¤§å«Â·å¶èŒ¨",
      "å§šæ™¨",
      "å§œæ–‡",
      "å­™æ·³",
      "å·©ä¿",
      "å¸Œæ–¯Â·è±æ°",
      "åº¹å®—å",
      "å¼ ä¸œå¥",
      "å¼ åŒç¥–",
      "å¼ å˜‰ä½³",
      "å¼ å›½",
      "å¼ å›½ç«‹",
      "å¼ å›½è£",
      "å¼ å­¦å‹",
      "å¼ å»ºäºš",
      "å¼ æ›¼ç‰",
      "å¼ æ¦•å®¹",
      "å¼ æ¶µäºˆ",
      "å¼ è‰¾å˜‰",
      "å¼ è£å‰",
      "å¼ éœ‡",
      "å½¦å°è¿½",
      "å¾å…‹",
      "å¾å³¥",
      "å¾å¸†",
      "å¾æ°",
      "æ‹‰è²Â·æ–¯æ³¢",
      "æ–¯åŸºç‰¹Â·ä¹Œå°”é‡Œå¥‡",
      "æ˜“çƒŠåƒçº",
      "æ›¾å¿—ä¼Ÿ",
      "æå˜‰æ¬£",
      "æå®‰",
      "æ¨åƒå¬…",
      "æ¨ç´«ç¼",
      "æ¨é‡‡é’°",
      "æ°å…‹Â·å‰ä¼¦å“ˆå°”",
      "æ—é’",
      "æ—é’éœ",
      "æŸ¯ä½³å¬¿",
      "æŸ¯è“",
      "æ¢æœ",
      "æ¢æœä¼Ÿ",
      "æ±¤å”¯",
      "æµ·ç‘ŸÂ·æ ¼",
      "ç‹å§¬",
      "ç‹å­¦åœ»",
      "ç‹å®",
      "ç‹å®¶å«",
      "ç‹æœ”",
      "ç‹è±",
      "ç‹è²",
      "ç‹è•™ç²",
      "ç™½ç™¾ä½•",
      "çœŸç”°å¹¿ä¹‹",
      "ç¨‹å­æ³½",
      "ç« å­æ€¡",
      "ç±³åˆ‡å°”Â·åˆ©",
      "ç½—æ–‡",
      "ç½—ç¾è–‡",
      "èˆ’æ·‡",
      "èŠ¦è‹‡",
      "è‹æ‹‰Â·æ²™ç›",
      "èŒƒå†°å†°",
      "èŒƒæ¤ä¼Ÿ",
      "è‘›ä¼˜",
      "è‘›æ°‘è¾‰",
      "è¢è‹‘",
      "è¥¿å¥¥Â·å®‰å“²ç½—æ™®æ´›æ–¯",
      "è©¹å¦®",
      "è©¹å¦®ä½›Â·èŠ¬å°¼ç”˜",
      "è©¹å§†æ–¯Â·å¼—é›·ç‰¹",
      "è®¸å† è‹±",
      "è¯ºæ‹‰",
      "è°¢å›­",
      "è°­å®¶æ˜",
      "èµµæ–‡ç‘„",
      "è¿ªç±³ç‰¹åˆ©Â·é©¬ä¸",
      "é‚“å…‰è£",
      "é‚“è¶…",
      "éƒé›„",
      "éƒ‘æ™“é¾™",
      "é‡‘åŸæ­¦",
      "é˜¿ä»€æ‹‰å¤«Â·å·´å§†",
      "é™ˆå‡¯æ­Œ",
      "é™ˆå‹‹å¥‡",
      "é™ˆé“æ˜",
      "é™ˆé£å®‡",
      "éœå»ºèµ·",
      "é©¬ä¼Ÿè±ª",
      "é©¬ç¾š",
      "é«˜åœ†åœ†",
      "é»„å»ºæ–°",
      "é»„æ¸¤",
      "é»„ç£Š",
      "é»„è£•",
      "é»„è½©",
      "é»åº”å°±",
      "é»æ˜"
    ]
  },
  "names": [
    "davidyates",
    "guynormanbee",
    "ä¸€ç§’é’Ÿ",
    "ä¸‡ç›æ‰æ—¦",
    "ä¸‡è¾¾å½±è§†",
    "ä¸Šå½±é›†å›¢",
    "ä¸Šæµ·ä¸œæ–¹å½±è§†å‘è¡Œæœ‰é™è´£ä»»å…¬å¸",
    "ä¸Šæµ·ç¹èŠ±é‡Œä¼ä¸šå‘å±•æœ‰é™å…¬å¸",
    "ä¸¥æ­Œè‹“",
    "ä¸­å›½ç”µå½±è‚¡ä»½æœ‰é™å…¬å¸",
    "ä¸­å½±é›†å›¢",
    "ä¸¹å°¼æ–¯Â·éœç€",
    "ä¹”æ²»Â·å·´å¸ƒé²é˜¿å°¼",
    "äºšå½“Â·é›·çº³",
    "ä»»è¾¾å",
    "å€ªæ·‘å›",
    "å‚…å½ª",
    "å…ƒå½ª",
    "å…‰çº¿ä¼ åª’",
    "å…³ä¹‹ç³",
    "å†¯å°åˆš",
    "å†¯æ·¬å¸†",
    "åˆ˜å¾·å",
    "åˆ˜æ’",
    "åˆ˜æ˜Šç„¶",
    "åˆ˜è‹¥è‹±",
    "åˆ˜é•‡ä¼Ÿ",
    "åŒ—äº¬ç”µå½±åˆ¶ç‰‡å‚",
    "åŒ—äº¬ç”µå½±å­¦é™¢é’å¹´ç”µå½±åˆ¶ç‰‡å‚",
    "åŒ—äº¬ç”µè§†è‰ºæœ¯ä¸­å¿ƒ",
    "åçº³å…„å¼Ÿ",
    "åè°Š",
    "åè°Šå…„å¼Ÿ",
    "åè°Šå…„å¼Ÿä¼ åª’æœ‰é™å…¬å¸",
    "åè°Šå…„å¼Ÿä¼ åª’é›†å›¢",
    "åšçº³å½±ä¸š",
    "å¢å† å»·",
    "å¶å€©æ–‡",
    "å•ä¸½è",
    "å•è‰¯ä¼Ÿ",
    "å´äº¬",
    "å´å€©è²",
    "å´å°äº‘",
    "å‘¨æ¶¦å‘",
    "å“ªå’ä¹‹é­”ç«¥é™ä¸–",
    "åœ°ä¹…å¤©é•¿",
    "å¤é’¢",
    "å¤§å«Â·å¶èŒ¨",
    "å¤©å¹•åˆ¶ä½œæœ‰é™å…¬å¸",
    "å§šæ™¨",
    "å§œæ–‡",
    "å­™æ·³",
    "å·©ä¿",
    "å¸Œæ–¯Â·è±æ°",
    "å¹¿è¥¿ç”µå½±åˆ¶ç‰‡å‚",
    "åº¹å®—å",
    "å¼ ä¸œå¥",
    "å¼ åŒç¥–",
    "å¼ å˜‰ä½³",
    "å¼ å›½",
    "å¼ å›½ç«‹",
    "å¼ å›½è£",
    "å¼ å­¦å‹",
    "å¼ å»ºäºš",
    "å¼ æ›¼ç‰",
    "å¼ æ¦•å®¹",
    "å¼ æ¶µäºˆ",
    "å¼ è‰¾å˜‰",
    "å¼ è£å‰",
    "å¼ éœ‡",
    "å½¦å°è¿½",
    "å½±ä¹‹æ°åˆ¶ä½œæœ‰é™å…¬å¸",
    "å¾å…‹",
    "å¾å³¥",
    "å¾å¸†",
    "å¾æ°",
    "æ‚¬å´–ä¹‹ä¸Š",
    "æˆ‘ä¸æ˜¯è¯ç¥",
    "æˆ‘ä¸æ˜¯è¯ç¥_222",
    "æˆ˜ç‹¼",
    "æ‹‰è²Â·æ–¯æ³¢",
    "æ–¯åŸºç‰¹Â·ä¹Œå°”é‡Œå¥‡",
    "æ–°ä¸½ä¼ åª’è‚¡ä»½æœ‰é™å…¬å¸",
    "æ–°è‰ºåŸå½±ä¸šå…¬å¸",
    "æ— é—´é“",
    "æ˜“çƒŠåƒçº",
    "æ›¾å¿—ä¼Ÿ",
    "æå˜‰æ¬£",
    "æå®‰",
    "æ¨åƒå¬…",
    "æ¨ç´«ç¼",
    "æ¨é‡‡é’°",
    "æ°å…‹Â·å‰ä¼¦å“ˆå°”",
    "æ—é’",
    "æ—é’éœ",
    "æŸ¯ä½³å¬¿",
    "æŸ¯è“",
    "æ¢æœ",
    "æ¢æœä¼Ÿ",
    "æ°¸ä½³å½±ä¸šæœ‰é™å…¬å¸",
    "æ±¤å”¯",
    "æ±¤è‡£ç”µå½±æœ‰é™å…¬å¸",
    "æ³½ä¸œç”µå½±å…¬å¸",
    "æ´¾æ‹‰è’™ä¸­å›½",
    "æµæµªåœ°çƒ",
    "æµ™æ±Ÿä¸œé˜³ç¾æ‹‰ä¼ åª’æœ‰é™",
    "æµ™æ±Ÿä¸œé˜³ç¾æ‹‰ä¼ åª’æœ‰é™å…¬å¸",
    "æµ·ç‘ŸÂ·æ ¼",
    "ç‹å§¬",
    "ç‹å­¦åœ»",
    "ç‹å®",
    "ç‹å®¶å«",
    "ç‹æœ”",
    "ç‹è±",
    "ç‹è²",
    "ç‹è•™ç²",
    "ç¯çƒå½±ä¸š",
    "ç™½ç™¾ä½•",
    "çœŸç”°å¹¿ä¹‹",
    "ç¨‹å­æ³½",
    "ç« å­æ€¡",
    "ç±³åˆ‡å°”Â·åˆ©",
    "ç´¢å°¼ç”µå½±å¨±ä¹å…¬å¸",
    "çº¢æµ·è¡ŒåŠ¨",
    "ç½—æ–‡",
    "ç½—ç¾è–‡",
    "ç¾å›½ç¦æ–¯æ¢ç…§ç¯å…¬å¸",
    "è…¾è®¯å½±ä¸š",
    "èˆ’æ·‡",
    "èŠ¦è‹‡",
    "è‹æ‹‰Â·æ²™ç›",
    "èŒƒå†°å†°",
    "èŒƒæ¤ä¼Ÿ",
    "è‘›ä¼˜",
    "è‘›æ°‘è¾‰",
    "è¢è‹‘",
    "è¥¿å¥¥Â·å®‰å“²ç½—æ™®æ´›æ–¯",
    "è¥¿å®‰ç”µå½±åˆ¶ç‰‡å‚",
    "è©¹å¦®",
    "è©¹å¦®ä½›Â·èŠ¬å°¼ç”˜",
    "è©¹å§†æ–¯Â·å¼—é›·ç‰¹",
    "è®©å­å¼¹é£",
    "è®©å­å¼¹é£_423",
    "è®¸å† è‹±",
    "è¯ºæ‹‰",
    "è°¢å›­",
    "è°­å®¶æ˜",
    "èµµæ–‡ç‘„",
    "è¿ªå£«å°¼ä¸­å›½",
    "è¿ªç±³ç‰¹åˆ©Â·é©¬ä¸",
    "è¿½é£ç­çš„äºº",
    "è¿½é£ç­çš„äºº_741",
    "è¿½é£ç­çš„äºº_781",
    "é‚“å…‰è£",
    "é‚“è¶…",
    "éƒé›„",
    "éƒ‘æ™“é¾™",
    "é‡‘åŸæ­¦",
    "é˜¿ä»€æ‹‰å¤«Â·å·´å§†",
    "é˜¿é‡Œå½±ä¸š",
    "é™ˆå‡¯æ­Œ",
    "é™ˆå‹‹å¥‡",
    "é™ˆé“æ˜",
    "é™ˆé£å®‡",
    "éœå»ºèµ·",
    "é©¬ä¼Ÿè±ª",
    "é©¬ç¾š",
    "é«˜åœ†åœ†",
    "é»„å»ºæ–°",
    "é»„æ¸¤",
    "é»„ç£Š",
    "é»„è£•",
    "é»„è½©",
    "é»åº”å°±",
    "é»æ˜"
  ],
}

# æå–åˆ—è¡¨
persons = data["detail"]["persons"]
movies = data["detail"]["movies"]
companies = data["detail"]["companies"]

# ========== è¿æ¥æ•°æ®åº“ ==========
driver = GraphDatabase.driver(URI, auth=(USERNAME, PASSWORD))

try:
    with driver.session() as session:
        session.run("RETURN 1")
    print("âœ… æˆåŠŸè¿æ¥åˆ° Neo4j")
except Exception as e:
    print("âŒ è¿æ¥å¤±è´¥:", e)
    exit(1)

# ========== å‡½æ•°ï¼šåˆ›å»ºèŠ‚ç‚¹ ==========
def create_nodes():
    with driver.session() as session:
        print("ğŸ“Œ æ­£åœ¨åˆ›å»ºäººç‰©èŠ‚ç‚¹...")
        for name in persons:
            session.run("""
                MERGE (p:Person {name: $name})
                SET p.created = timestamp()
            """, name=name)

        print("ğŸ“Œ æ­£åœ¨åˆ›å»ºç”µå½±èŠ‚ç‚¹...")
        for name in movies:
            session.run("""
                MERGE (m:Movie {name: $name})
                SET m.year = 2000 + toInteger(rand() * 25),
                    m.box_office = toInteger(rand() * 100000)  // éšæœºç¥¨æˆ¿ï¼ˆä¸‡å…ƒï¼‰
            """, name=name)

        print("ğŸ“Œ æ­£åœ¨åˆ›å»ºå…¬å¸èŠ‚ç‚¹...")
        for name in companies:
            session.run("""
                MERGE (c:Company {name: $name})
            """, name=name)

        print("âœ… æ‰€æœ‰èŠ‚ç‚¹åˆ›å»ºå®Œæˆ")
def create_movie_genres_only():
    """
    ä¸ºæ‰€æœ‰å·²å­˜åœ¨çš„ Movie èŠ‚ç‚¹ç»‘å®š 2 ä¸ªéšæœºç±»å‹ï¼Œå¹¶ç¡®ä¿ä¸é‡å¤
    """
    with driver.session() as session:
        genre_names = [
            "å‰§æƒ…", "å–œå‰§", "åŠ¨ä½œ", "çˆ±æƒ…", "ç§‘å¹»", "æ‚¬ç–‘", "æƒŠæ‚š", "ææ€–",
            "åŠ¨ç”»", "å†’é™©", "çŠ¯ç½ª", "å†å²", "æˆ˜äº‰", "éŸ³ä¹", "å®¶åº­", "å¥‡å¹»"
        ]

        print("ğŸ“Œ æ­£åœ¨åˆ›å»ºæ‰€æœ‰ç±»å‹èŠ‚ç‚¹ (Genre)...")
        for name in genre_names:
            session.run("MERGE (:Genre {name: $name})", name=name)

        # ğŸ”¥ ğŸ”¥ ğŸ”¥ å…³é”®ï¼šå¼ºåˆ¶åˆ é™¤æ‰€æœ‰ HAS_GENRE å…³ç³»ï¼Œå¹¶ç¡®è®¤åˆ é™¤
        print("ğŸ§¹ æ­£åœ¨åˆ é™¤æ‰€æœ‰ç”µå½±-ç±»å‹å…³ç³»...")
        deleted = session.run("MATCH ()-[r:HAS_GENRE]->() DELETE r RETURN count(r) AS deleted_count")
        count = [record["deleted_count"] for record in deleted][0]
        print(f"ğŸ—‘ï¸  å·²åˆ é™¤ {count} æ¡ HAS_GENRE å…³ç³»")

        # è·å–æ‰€æœ‰ç”µå½±
        result = session.run("MATCH (m:Movie) RETURN m.name AS name")
        movies = [record["name"] for record in result]

        if not movies:
            print("âŒ æ²¡æœ‰æ‰¾åˆ°ä»»ä½• Movie èŠ‚ç‚¹ï¼Œè¯·å…ˆåˆ›å»ºç”µå½±ï¼")
            return

        print(f"ğŸ¬ å…± {len(movies)} éƒ¨ç”µå½±ï¼Œæ­£åœ¨ç»‘å®š 2 ä¸ªç±»å‹...")

        # ä¸ºæ¯éƒ¨ç”µå½±ç»‘å®š 2 ä¸ªéšæœºç±»å‹
        for movie_name in movies:
            chosen_genres = random.sample(genre_names, k=2)  # å›ºå®šä¸º 2 ä¸ª

            for genre_name in chosen_genres:
                session.run("""
                    MATCH (m:Movie {name: $movie_name})
                    MATCH (g:Genre {name: $genre_name})
                    MERGE (m)-[:HAS_GENRE]->(g)
                """, movie_name=movie_name, genre_name=genre_name)

        print("âœ… æ‰€æœ‰ç”µå½±çš„ç±»å‹ç»‘å®šå®Œæˆï¼")
# ========== ä¸»å‡½æ•° ==========
def main():
    print("ğŸš€ å¼€å§‹å†™å…¥æ•°æ®åˆ° Neo4j...")
    create_nodes()

    # âœ… æ–°å¢ï¼šç»‘å®šç”µå½±ç±»å‹
    create_movie_genres_only()

    print("ğŸ‰ æ•°æ®å†™å…¥å®Œæˆï¼åŒ…å«ç”µå½±ç±»å‹ã€‚")


if __name__ == "__main__":
    main()